# 장애 대응 훈련
## 시나리오
```
1. 장애 탐지 (시스템 알람, 고객센터, QA팀, 사내제보)
2. 장애 공지 (Slack, KakaoTalk 등 실시간 알람을 받을 수 있는 SNS 활용)
3. 장애 전파 (사내 내부 조직, 팀원, 고객 등)
4. 장애 복구
5. 장애 후속 조치
6. 장애 회고 (왜 장애가 발생했으며, 앞으로 어떻게 처리해야 할지 대응책 마련)
```
### 장애 탐지
- 시스템 지표: CPU, Memory, latency, 5xx error count 등
- 비즈니스 지표: 가게 상세 진입률, 주문 추이 등
- 외부 연동 시스템 지표: 연동시스템 주문 전달 실패, 프랜차이즈 시스템 오류 등


- 부하테스트 시나리오 및 진행 문서 제출
    - 아래내용을 포함
        - 테스트 하는 상황 (유저 시나리오와 최대한 비슷하게)
        - 현재 DB에 적재되어있는 데이터의 수
        - 동시 요청의 수
        - 우리가 기대하는 응답값 (P99 등)
- 서버의 확장, 배포과정에서 발생할 수 있는 장애 및 SPOF 에 대한 분석 레포트 제출
    - 아래 내용을 포함
        - 서버 배포 실패에 대한 대응방안
        - 우리 서비스의 외부 의존성 파악
        - 배포시의 하위호환성 보장 전략
        - 롤백에 대한 배포전략
---
## 부하테스트
**부하**란, **처리를 실행하려고 해도 실행할 수 없어서 대기하고 있는 프로세스의 수**를 의미
### 처리량
![[Pasted image 20231025191233.png]]

### 테스트 설정값 구하기
#### 1. 목표 rps 구하기
a. 우선 예상 1일 사용자 수(DAU)를 정해봅니다.  
b. 피크 시간대의 집중률을 예상해봅니다. (최대 트개픽 / 평소 트래픽)  
c. 1명당 1일 평균 접속 혹은 요청수를 예상해봅니다.  
d. 이를 바탕으로 Throughput을 계산합니다.

- **Throughput : 1일 평균 rps ~ 1일 최대 rps**
    - 1일 사용자 수(DAU) x 1명당 1일 평균 접속 수 = 1일 총 접속 수
    - 1일 총 접속 수 / 86,400 (초/일) = 1일 평균 rps
    - 1일 평균 rps x (최대 트래픽 / 평소 트래픽) = 1일 최대 rps
#### 2. VUser 구하기
- Request Rate: measured by the number of requests per second (RPS)
- VU: the number of virtual users
- R: the number of requests per VU iteration
- T: a value larger than the time needed to complete a VU iteration
```plaintext
T = (R * http_req_duration) (+ 1s) ; 내부망에서 테스트할 경우 예상 latency를 추가한다
VUser = (목표 rps * T) / R
```
- 가령, 두개의 요청 (**R=2**)이 있고, 왕복시간이 0.5s, 지연시간이 1초라고 가정할 때 (**T=2**), 계산식은 아래와 같다.
> VU = (300 * 2) / 2 = 300
#### 3. 테스트 기간
- 일반적으로 Load Test는 보통 30분 ~ 2시간 사이로 권장합니다. 부하가 주어진 상황에서 DB Failover, 배포 등 여러 상황을 부여하며 서비스의 성능을 확인합니다.